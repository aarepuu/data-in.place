version: '3.3'

networks:
  web:
    external: true

services:
  app:
    container_name: aus-datainplace
    platform: linux/amd64
    build: .
    restart: always
    expose:
      - 80
    networks:
      - web
    labels:
      - 'traefik.enable=true'
      - 'traefik.docker.network=web'
      - 'traefik.http.routers.aus-datainplace.rule=Host(`app.${DEPLOYMENT}`)'
      - 'traefik.http.routers.aus-datainplace.entrypoints=websecure'
      - 'traefik.http.routers.aus-datainplace-web.tls=true'
      - 'traefik.http.routers.aus-datainplace.tls.certresolver=myresolver'
    env_file: .env
    logging:
      driver: 'json-file'
      options:
        max-size: '1024k'
        max-file: '10'
